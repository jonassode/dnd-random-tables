<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Random Table Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #1a202c; font-family: 'Inter', sans-serif; color: #e2e8f0; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 1rem; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #2d3748; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 4px; }
        .hidden { display: none; }
    </style>
</head>
<body class="selection:bg-teal-500 selection:text-white">
    <div class="w-full max-w-2xl bg-gray-800 p-8 rounded-xl shadow-2xl space-y-8 flex flex-col items-center">
        <header class="text-center space-y-2">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-teal-400 to-blue-500">
                Random Table Generator
            </h1>
            <p class="text-gray-400 text-lg">
                Generate a random result from a custom list.
            </p>
        </header>
        <div id="selection-screen" class="w-full space-y-4 text-center">
            <p class="text-xl font-semibold text-gray-300">
                Choose a table to roll on:
            </p>
            <div id="table-buttons" class="flex flex-col items-center space-y-4"></div>
        </div>
        <div id="encounter-screen" class="w-full hidden space-y-4">
            <div id="result-display" class="w-full min-h-[150px] p-6 bg-gray-700 border border-gray-600 rounded-lg shadow-inner flex flex-col justify-center items-center text-center"></div>
            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                <button id="reroll-btn" class="px-8 py-3 bg-gradient-to-r from-teal-500 to-blue-600 hover:from-teal-600 hover:to-blue-700 text-white font-bold rounded-full shadow-lg transition-transform transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-opacity-50">
                    Reroll on this table
                </button>
                <button id="back-btn" class="px-8 py-3 bg-gray-600 hover:bg-gray-700 text-gray-300 font-bold rounded-full shadow-lg transition-transform transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-opacity-50">
                    Choose New Table
                </button>
            </div>
        </div>
    </div>
    <script>
        // Discover all table JSON files in /tables/
        // In a real server, you might fetch a list from the server or keep an index file.
        // For static hosting, maintain a manifest:
        const TABLE_MANIFEST = [
            "jungle_encounters.json",
            "battle_encounters.json",
            "city_encounters.json",
            "wizard_room_items.json",
            "social_encounters_list.json"
        ];

        // This will be filled with { tableName: [items] }
        const contentTables = {};
        let currentTableType = null;

        async function loadAllTables() {
            const promises = TABLE_MANIFEST.map(async (filename) => {
                const response = await fetch(`tables/${filename}`);
                if (!response.ok) throw new Error(`Failed to load ${filename}`);
                const data = await response.json();
                contentTables[data.name] = data.items;
            });
            await Promise.all(promises);
        }

        function renderButtons() {
            const buttonContainer = document.getElementById('table-buttons');
            buttonContainer.innerHTML = '';
            const tableNames = Object.keys(contentTables);
            tableNames.forEach(tableName => {
                const button = document.createElement('button');
                let buttonClass = '';
                if (tableName === 'jungle_encounters') {
                    buttonClass = 'bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 focus:ring-green-500';
                } else if (tableName === 'social_encounters') {
                    buttonClass = 'bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 focus:ring-blue-500';
                } else if (tableName === 'city_encounters') {
                    buttonClass = 'bg-gradient-to-r from-orange-500 to-amber-600 hover:from-orange-600 hover:to-amber-700 focus:ring-orange-500';
                } else if (tableName === 'wizard_room_items') {
                    buttonClass = 'bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 focus:ring-purple-500';
                } else {
                    buttonClass = 'bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 focus:ring-gray-500';
                }
                button.className = `px-8 py-3 text-white font-bold rounded-full shadow-lg transition-transform transform hover:scale-105 active:scale-95 focus:outline-none focus:ring-4 focus:ring-opacity-50 ${buttonClass}`;
                button.textContent = `${tableName.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')} Table`;
                button.dataset.type = tableName;
                button.addEventListener('click', (event) => {
                    const tableType = event.currentTarget.dataset.type;
                    generateResult(tableType);
                });
                buttonContainer.appendChild(button);
            });
        }

        function showSelectionScreen() {
            document.getElementById('selection-screen').classList.remove('hidden');
            document.getElementById('encounter-screen').classList.add('hidden');
        }

        function generateResult(tableType) {
            const contentList = contentTables[tableType];
            if (!contentList || contentList.length === 0) {
                const displayEl = document.getElementById('result-display');
                displayEl.innerHTML = `<p class="text-xl font-semibold text-red-400">Error: No content found for this category!</p>`;
                return;
            }
            const randomIndex = Math.floor(Math.random() * contentList.length);
            const randomItem = contentList[randomIndex];
            const displayEl = document.getElementById('result-display');
            displayEl.innerHTML = `
                <h2 class="text-2xl sm:text-3xl font-bold text-teal-300 mb-2">
                    ${randomItem.title}
                </h2>
                <p class="text-lg text-gray-400 px-4">
                    ${randomItem.description}
                </p>
            `;
            currentTableType = tableType;
            document.getElementById('selection-screen').classList.add('hidden');
            document.getElementById('encounter-screen').classList.remove('hidden');
        }

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await loadAllTables();
                renderButtons();
            } catch (e) {
                document.getElementById('table-buttons').innerHTML =
                    `<p class="text-red-400 font-bold">Failed to load tables: ${e.message}</p>`;
            }
            const rerollBtn = document.getElementById('reroll-btn');
            const backBtn = document.getElementById('back-btn');
            if (rerollBtn) rerollBtn.addEventListener('click', () => {
                if (currentTableType) generateResult(currentTableType);
            });
            if (backBtn) backBtn.addEventListener('click', showSelectionScreen);
        });
    </script>
</body>
</html>
